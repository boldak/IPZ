# Node.js

Серверна платформа Node це середовище виконання JavaScript, побудована на базі JS-двіжка V8, розробленого Google і застосовуваного в Google Chrome. Node.js використовує не блоковану модель введення-виведення, керовану подіями, яка робить цю платформу простою і ефективною.

## Сценарії застосування Node

1. Додатки реального часу  

Додатки для спільної роботи (такі, як Trello і Google Docs), інтерактивні чати, системи миттєвого обміну повідомленнями та онлайн-ігри - це приклади додатків реального часу. Для нормальної роботи таких додатків система, на якій вони засновані, повинна забезпечувати дуже високу швидкість відгуку на дії користувача і низький рівень затримок. Node відповідає цим вимогам.

2. Односторінкові додатки 

Односторінковий додаток - це додаток, який представляє єдину завантажуюму в браузер веб-сторінку, вміст якої динамічно оновлюється в ході взаємодії з нею користувача.

3. Масштабованість  

Сервер на Node ніколи не виявиться набагато могутнішим, ніж потрібно. Модульність Node дозволяє створювати маленькі додатки, не стикаючись при цьому з необхідністю підтримки величезної інфраструктури, багато частин якої в якомусь конкретному випадку виявляється не задіяними. При розробці Node-додатків програміст вибирає саме те, що йому потрібно, і, при необхідності, розширює рішення.

## Основи npm

Npm (node package manager) - це менеджер пакетів Node.js.

Npm працює, виконуючи одну зі своїх двох ролей:

* Це широко використовуваний репозиторій для публікації проектів Node.js з відкритим вихідним кодом. Це означає, що це онлайн-платформа, де кожен може публікувати та ділитися інструментами, написаними на JavaScript.
* Npm - це інструмент командного рядка, який допомагає взаємодіяти з онлайн-платформами, такими як браузери і сервери. Ця утиліта допомагає в установці і видаленні пакетів, управлінні версіями і залежностями, необхідними для запуску проекту.

### Установка пакетів

Окремий пакет можна встановити за допомогою такої команди: `npm install <package-name>`

**Наприклад**:  

Команда `npm install lodash`

**Результат**:

Консоль
``` 
+ lodash@4.17.15
added 1 package from 2 contributors and audited 1 package in 3.349s
found 0 vulnerabilities
```  
package-lock.json
```json
{
  "requires": true,
  "lockfileVersion": 1,
  "dependencies": {
    "lodash": {
      "version": "4.17.15",
      "resolved": "https://registry.npmjs.org/lodash/-/lodash-4.17.15.tgz",
      "integrity": "sha512-8xOcRHvCjnocdS5cpwXQXVzmmh5e5+saE2QGoeQmbKmRS6J3VQppPOIt0MnmE+4xlZoumy0GPG0D0MVIQbNA1A=="
    }
  }
}
```  
package.json
```json
{
  "name": "Test",
  "version": "1.0.0",
  "dependencies": {
    "lodash": "^4.17.15"
  }
}
```

Часто можна бачити, як цю команду використовують не в такому ось простому вигляді, а з деякими прапорами:
* Прапор `--save` дозволяє встановити пакет і додати запис про нього в розділ 	 файлу package.json, який описує залежності проекту. Після виходу npm 5 записи про встановлювані пакети в розділі залежностей робляється автоматично, і без використання цього прапора. **Наприклад**: `npm install --save lodash`
* Прапор `--save-dev` дозволяє встановити пакет і додати запис про нього в розділ, що містить перелік залежностей розробки (тобто - пакетів, які потрібні в ході розробки проекту, на зразок бібліотек для тестування, але не потрібні для його роботи) файлу package. json, який називається devDependencies. **Наприклад**:

package.json  
```json
{
  "name": "modulesapp",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.17.1",
    "react": "^16.9.0",
    "react-dom": "^16.9.0"
  },
  "devDependencies": {
    "jasmine-node": "^3.0.0"
  }
}
```

Якщо в проекті є файл package.json, **наприклад**:

package.json  
```json
{
  "name": "modulesapp",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.17.1",
    "react": "^16.9.0",
    "react-dom": "^16.9.0"
  }
}
```  
то встановити всі залежності цього проекту можна такою командою: `npm install`  
Ця команда завантажить все, що потрібно проекту, і помістить ці матеріали в папку node_modules, створивши її в тому випадку, якщо вона не існує в директорії проекту.

### Видалення пакетів

Окремий пакет можна видалити за допомогою такої команди: `npm uninstall <package-name>`

**Наприклад**:  

Команда `npm uninstall lodash`

**Результат**:

Консоль
``` 
removed 1 package in 0.82s
found 0 vulnerabilities
```  
package-lock.json
```json
{
  "lockfileVersion": 1
}
```  
package.json
```json
{
  "name": "Test",
  "version": "1.0.0",
  "dependencies": {}
}
```

### Оновлення пакетів

Для оновлення пакетів служить наступна команда: `npm update`

Отримавши цю команду, npm перевірить всі пакети на наявність їх нових версій, і, якщо знайде їх нові версії, відповідні обмеженням на версії пакетів, заданим в package.json, встановить їх.

Оновити можна і окремий пакет: `npm update <package-name>`

### Зміна версії node

Для встановлення певної версії node.js служить наступна команда: `npm install node@version`

### Загрузка пакетів певних версій

На додаток до стандартної завантаженні пакетів, npm підтримує і завантаження їх певних версій. Зокрема, можна помітити, що деякі бібліотеки сумісні лише з якимись великими релізами інших бібліотек, тобто, якби залежності таких бібліотек встановлювалися б без урахування версій, це могло б порушити їх роботу. Можливість встановити певну версію якогось пакета корисна і в ситуаціях, коли, наприклад, вам цілком підходить найсвіжіший реліз цього пакета, але виявляється, що в ньому є помилка. Чекаючи виходу виправленої версії пакету, можна скористатися і його старішим але стабільним релізом.

Можливість задавати конкретні версії необхідних проекту бібліотек корисна в командній розробці, коли всі члени команди користуються в точності одними і тими ж бібліотеками. Перехід на їх нові версії так само здійснюється централізовано, шляхом внесення змін до файл проекту package.json.

У всіх цих випадках можливість вказівки версій пакетів, необхідних проекту, надзвичайно корисна. Npm слід стандарту семантичного версіонування (semver).

### Куди npm встановлює пакети?

При установці пакетів з використанням npm доступні два варіанти установки: локальна і глобальна.
За замовчуванням, коли для установки пакета використовують команду на зразок npm install lodash, пакет виявляється в папці node_modules, розташованої в папці проекту. Крім того, якщо була виконана вищеописана команда, npm також додасть запис про бібліотеку lodash в розділ dependencies файлу package.json, який є в поточній директорії.

Глобальна установка пакетів виконується з використанням прапора -g: `npm install -g <package-name>`

Виконуючи таку команду, npm не встановлює пакет в локальну папку проекту. Замість цього він копіює файли пакета в якесь глобальне розташування. Куди саме потрапляють ці файли? Для того щоб це дізнатися, скористайтеся командою: `npm root –g`

У Windows це може бути щось на зразок `C:\Users\YOU\AppData\Roaming\npm\node_modules`.

**Наприклад**: на моєму комп'ютері це `C:\Users\Denny\AppData\Roaming\npm\node_modules`.

## Файл package.json

Файл package.json є найважливішим елементом безлічі проектів, заснованих на екосистемі Node.js. 
Package.json є чимось на зразок файлу-маніфесту для проекту. 

Можна виділити наступні властивості:

* name - задає ім'я програми (пакета).
* version - містить відомості про поточну версію програми.
* description - короткий опис програми.
* main - задає точку входу в додаток.
* private - якщо ця властивість встановлено в true, це дозволяє запобігти випадкову публікацію пакета в npm.
* scripts - задає набір Node.js-скриптів, які можна запускати.
* dependencies - містить список npm-пакетів, від яких залежить додаток.
* devDependencies - містить список npm-пакетів, які використовуються при розробці проекту, але не при його реальній роботі.
* engines - задає список версій Node.js, на яких працює додаток.
* browserlist - використовується для зберігання списку браузерів (і їх версій), які має підтримувати додаток.

Дедальніше на прикладі package.json
```json
{
  "name": "project",
  "version": "1.0.0",
  "description": "Test",
  "main": "test.js",
  "license": "ISC",
  "private": true,
  "dependencies": {
    "lodash": "latest"
  },
  "scripts": {
    "start":"node test.js"
  },
  "repository": "github:https://github.com/lodash/lodash"
}
```

### Властивість name задає ім'я пакета:

`"name": "test"`

Ім'я повинно бути коротше 214 символів, не повинно включати в себе прогалини, може містити дефіс (-) і символи підкреслення (_). Подібні обмеження існують через те, що коли пакет публікується в npm, його ім'я використовується для формування URL сторінки пакета.

Якщо ви публікували код пакета на GitHub, в загальному доступі, то хорошим варіантом імені пакета є ім'я відповідного GitHub-сховища.

### Властивість version містить відомості про поточну версію пакету:

`"version": "1.0.0"`

При формуванні значення цієї властивості потрібно слідувати правилам семантичного версіонування. Це означає, зокрема, що номер версії завжди представлений трьома цифрами: x.x.x.
Перше число - це мажорна версія пакету, друге - мінорна версія, третє - патч-версія.
Зміна цих чисел несе в собі певний сенс. Так, реліз пакету, в якому лише виправляються помилки, призводить до збільшення значення патч-версії. Якщо виходить реліз пакету, зміни, внесені в який, відрізняються зворотну сумісність з попереднім релізом - то змінюється мінорна версія. У мажорних версіях пакетів можуть бути присутніми зміни, які роблять ці пакети несумісними з пакетами попередніх мажорних версій.

### Властивість description містить короткий опис пакету:

`"description": "A test.js project"`

Це властивість особливо важливо в тому випадку, якщо ви плануєте публікувати пакет в npm, так як воно дозволяє користувачам сайту npm зрозуміти призначення пакета.

### Властивість main задає точку входу в пакет:

`"main": "test.js"`

Коли пакет імпортують в додаток, саме тут буде здійснюватися пошук того, що експортує відповідний модуль.

### Властивість private

Властивість private, встановлене в true, дозволяє запобігти випадкову публікацію пакета в npm:

`"private": true`

### Властивість dependencies містить список npm-пакетів, встановлених у вигляді залежностей пакета:

```json  
  "dependencies": {
    "lodash": "^4.17.15"
  }
```

### Властивість script

Властивість scripts задає список скриптів, які можна запускати за допомогою npm:

`npm run start`

### Властивість repository вказує на те, де знаходиться репозиторій пакета:

`"repository": "github:https://github.com/lodash/lodash"`

Зверніть увагу, що у значення цієї властивості є префікс github. Npm підтримує префікси. Можна задати і в явному вигляді:

```json
"repository": {
   "type": "git",
   "url": "https://github.com/lodash/lodash"
}
```

## Версії пакетів і семантичне версіонування

У вищенаведених прикладах ви могли бачити, що номери версій пакетів задаються не тільки у вигляді звичайних чисел, розділених точками, але і з використанням деяких спеціальних символів. Наприклад, у вигляді ~ 3.0.0 або ^ 0.13.0. Тут використані так звані специфікатор версій, які визначають діапазон версій пакетів, придатних для використання в нашому пакеті.
Такі правила використання специфікаторів версій:
*	`~`: Якщо ви задаєте версію у вигляді ~ 0.13.0 це означає, що вас цікавлять лише патч-релізи пакета. Тобто, пакет 0.13.1 вам підійде, а 0.14.0 - немає.

**Наприклад**: `npm install lodash@"~4.17.1"`

**Результат**:

package.json
```json
{
  "name": "untitled",
  "version": "1.0.0",
  "dependencies": {
    "lodash": "^4.17.15"
  }
}
```
  
*	`^`: Якщо номер версії заданий у вигляді ^ 0.13.0, це означає, що вам підходять нові патч-версії і мінорні версії пакету. Тобто, вас влаштують версії пакету 0.13.1, 0.14.0, і так далі.

**Наприклад**: `npm install lodash@"^4.15.0"`

**Результат**:

package.json
```json
{
  "name": "untitled",
  "version": "1.0.0",
  "dependencies": {
    "lodash": "^4.17.15"
  }
}
```

*	`*`: Скориставшись цим символом, ви повідомляєте системі, що вас влаштують будь-які свіжі версії пакету, в тому числі - його нові мажорні релізи.

**Наприклад**: `npm install lodash@"*3.10.1"`

**Результат**:

package.json
```json
{
  "name": "untitled",
  "version": "1.0.0",
  "dependencies": {
    "lodash": "^4.17.15"
  }
}
```

*	`>`: Підходять будь-які версії пакету, які більше заданої.

**Наприклад**: `npm install lodash@">2.4.2"`

**Результат**:

package.json
```json
{
  "name": "untitled",
  "version": "1.0.0",
  "dependencies": {
    "lodash": "^4.17.15"
  }
}
```

*	`>=`: Підходять будь-які версії пакету, які дорівнюють або перевищують заданої.

**Наприклад**: `npm install lodash@">=4.17.0"`

**Результат**:

package.json
```json
{
  "name": "untitled",
  "version": "1.0.0",
  "dependencies": {
    "lodash": "^4.17.15"
  }
}
```

*	`<=`: Вас влаштують пакети, версії яких дорівнюють заданої або менше її.

**Наприклад**: `npm install lodash@"<=3.10.1"`

**Результат**:

package.json
```json
{
  "name": "untitled",
  "version": "1.0.0",
  "dependencies": {
    "lodash": "^3.10.1"
  }
}
```

*	`<`: Вас цікавлять пакети, версії яких менше заданої.

**Наприклад**: `npm install lodash@"<4.17.15"`

**Результат**:

package.json
```json
{
  "name": "untitled",
  "version": "1.0.0",
  "dependencies": {
    "lodash": "^4.17.14"
  }
}
```

*	`=`: Вам потрібна тільки задана версія пакету.

**Наприклад**: `npm install lodash@"=4.17.1"`

**Результат**:

package.json
```json
{
  "name": "untitled",
  "version": "1.0.0",
  "dependencies": {
    "lodash": "^4.17.1"
  }
}
```

*	`-`: використовується для вказівки діапазону відповідних версій, наприклад - 2.1.0 - 2.6.2.

**Наприклад**: `npm install lodash@"2.4.2 - 3.10.1"`

**Результат**:

package.json
```json
{
  "name": "untitled",
  "version": "1.0.0",
  "dependencies": {
    "lodash": "^3.10.1"
  }
}
```

*	`||`: дозволяє комбінувати набори умов, що стосуються пакетів. Наприклад це може виглядати як <2.1 || > 2.6.

**Наприклад**: `npm install lodash@"<2.4.2 || > 4.17.0"`

**Результат**:

package.json
```json
{
  "name": "untitled",
  "version": "1.0.0",
  "dependencies": {
    "lodash": "^4.17.15"
  }
}
```

Є і ще деякі правила:

*	відсутність додаткових символів: якщо використовується номер версії пакета без додаткових символів, це означає, що вашому пакету потрібна тільки задана версія пакету-залежності і ніяка інша.
*	latest: вказує на те, що вам потрібно найсвіжіша версія якогось пакета.

Більшість вищеописаних специфікаторів можна комбінувати, наприклад, задаючи діапазони відповідних версій пакетів-залежностей. Скажімо, конструкція виду 1.0.0 || > = 1.1.0 <1.2.0 вказує на те, що планується використовувати або версію пакета 1.0.0, або версію, номер якої більше або дорівнює 1.1.0, але менше 1.2.0.

## Файл package-lock.json

Файл package-lock.json використовується з моменту появи npm версії 5. Він створюється автоматично при установці Node.js-пакетів. Цей файл вирішує вельми специфічну проблему, яка не вирішується засобами package.json. У package.json можна вказати, які оновлення якогось пакета вам підходять (патч-версії або мінорні версії) з використанням вищеописаних специфікаторів версій.

У Git НЕ комітять папку node_modules, так як зазвичай вона має величезні розміри. Коли ви намагаєтеся відтворити проект на іншому комп'ютері, то використання команди npm install призведе до того, що, якщо, при використанні специфікатор ~ в застосуванні до версії якогось пакета, вийшов його патч-реліз, встановлений буде не той пакет, який використовувався при розробці, а саме цей патч-реліз. Те ж саме стосується і специфікатор ^. Якщо ж при вказівці версії пакету специфікатор не використовувалися, то буде встановлена саме його зазначена версія і проблема, про яку йде мова, опиниться в такій ситуації неактуальною.

Файл package-lock.json зберігає в незмінному вигляді відомості про версії кожного встановленого пакета і npm буде використовувати саме ці версії пакетів при виконанні команди `npm install`. Ця концепція не нова, менеджери пакетів, що застосовуються в інших мовах програмування (менеджера Composer в PHP) використовують схожу систему багато років.

Файл package-lock.json потрібно відправити в Git-репозиторій, що дозволить іншим людям завантажити його в тому випадку, якщо проект є загальнодоступним, або тоді, коли його розробкою займається команда програмістів, або якщо ви використовуєте Git для розгортання проекту.

Версії залежностей будуть оновлені в package-lock.json після виконання команди `npm update`. У кожного файл package-lock.json є поле version, є поле resolved, яке вказує на розташування пакета, і строкове властивість integrity, яке можна використовувати для перевірки цілісності пакету.

package-lock.json
```json
{
  "name": "project",
  "version": "1.0.0",
  "lockfileVersion": 1,
  "requires": true,
  "dependencies": {
    "lodash": {
      "version": "4.17.15",
      "resolved": "https://registry.npmjs.org/lodash/-/lodash-4.17.15.tgz",
      "integrity": "sha512-8xOcRHvCjnocdS5cpwXQXVzmmh5e5+saE2QGoeQmbKmRS6J3VQppPOIt0MnmE+4xlZoumy0GPG0D0MVIQbNA1A=="
    }
  }
}
```

## Матеріал підготували студенти групи ІВ-81:
* **Зікратий Дмитро** - [shooterdimon](https://github.com/shooterdimon)
* **Тріщук Денис** - [krissayrose](https://github.com/krissayrose)
